enum TransactionType {
  TRANSFER
  MINT
  BURN
}

# Represents a single transaction, linked to a holder and a token.
type TokenHolderTransaction @entity(immutable: true) {
  id: ID! # <tokenholder ID>-transaction-logIndex
  balance: BigDecimal!
  block: BigInt!
  date: String! # ISO 8601 format
  type: TransactionType!
  holder: TokenHolder!
  previousBalance: BigDecimal!
  timestamp: String! # Unix format
  transaction: Bytes!
  transactionLogIndex: BigInt!
  value: BigDecimal!
}

# Daily balance for a specific holder and token
type TokenHolderBalance @entity {
  # One per day
  id: ID! # <tokenholder ID>-<YYYY-MM-DD>
  date: String! # YYYY-MM-DD
  holder: TokenHolder!
  balance: BigDecimal!
}

# Rollup entity for a specific holder and token, which enables access to their balances
type TokenHolder @entity {
  id: ID! # <token ID>-holder
  balance: BigDecimal!
  holder: Bytes!
  token: Token!
  balances: [TokenHolderBalance!]! @derivedFrom(field: "holder")
}

# Daily snapshot for a specific token
# This entity enables getting balances for a specific day, without
# knowing the addresses of holders
type TokenDailySnapshot @entity {
  id: ID! # <token ID>/<YYYY-MM-DD>
  date: String! # YYYY-MM-DD
  token: Token!
  # Un-managed list containing the IDs of TokenHolderBalance records
  # for a specific day and token. A separate query can be run to fetch
  # the records using the `where:{id_in: <list>}` filter for GraphQL.
  balancesList: [String!]!
}

type Token @entity {
  id: ID! # token-blockchain
  address: Bytes!
  blockchain: String!
  name: String!
  dailySnapshots: [TokenDailySnapshot!]! @derivedFrom(field: "token")
}
